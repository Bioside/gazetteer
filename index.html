<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Gazetteer: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Gazetteer
   &#160;<span id="projectnumber">1.2</span>
   </div>
   <div id="projectbrief">OpenStreetMapGazetteer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Gazetteer Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Takes osm file and create json/csv output for every feature with crossreferences.</p>
<p>With next goals in mind:</p>
<ul>
<li>Easy to deploy (keep number of external dependencyes as low as possible)</li>
<li>Memory friendly (most parts can be easily rewrited, to use file indexes and save ram)</li>
<li>Clusterization friendly (build whole process as a number of tasks, which can be performed in multi-thread/multi-node environment)</li>
</ul>
<h2>Use latest release </h2>
<p>You could find binaries here <a href="https://github.com/kiselev-dv/gazetteer/releases/">https://github.com/kiselev-dv/gazetteer/releases/</a></p>
<h2>Or compile with apache maven </h2>
<pre class="fragment">#Install kiselev-dv/osm-doc-java
mvn compile install -f osm-doc-java/pom.xml

#Install lemire/externalsortinginjava
mvn compile install -f lemire/externalsortinginjava

#Compile and assemble gazetteer
mvn clean compile assembly:single -f Gazetteer/pom.xml
</pre><h2>how it works </h2>
<p>Data processed in two steps:</p>
<p>Stripe (map) Join (reduce)</p>
<p>Also there is a zero step split which splits single osm file into nodes, ways and relations.</p>
<h2>Typical workflow </h2>
<pre class="fragment">#Do some preparations: split whole OSM file into 3 files with nodes, ways, and relations.
java -jar gazetteer.jar split country.osm

#Parse data and stripe it
java -jar gazetteer.jar slice

#Do spatial join
java -jar gazetteer.jar join --handlers out-gazetteer /path/to/save/out.json.gz
</pre><h2>Results </h2>
<p>Each line of out.json.gz contains one object encoded as JSON object.</p>
<p>Objects are</p>
<ul>
<li>poipnt POI (Places of interest)</li>
<li>adrpnt Addresses (Building or node with addr:nousenumber)</li>
<li>hghway Highway (Street or street segment. Each osm way will creates one or more hghway object)</li>
<li>hghnet Highways networks (Streets grouped by names and upward boundaries)</li>
<li>plcpnt Place point (Places)</li>
<li>admbnd Admin boundary (Administrative boundaries)</li>
</ul>
<p>Addresses stored inside address.parts array and arranged by levels as</p>
<ul>
<li>admin0_name</li>
<li>admin1_name</li>
<li>admin2_name</li>
<li>local_admin_name</li>
<li>locality_name</li>
<li>street_name</li>
</ul>
<p>See: /GazetteerWeb/src/main/resources/mappings/location.json</p>
<h2>Tips and Trics </h2>
<h4>1 Speed and memory consumption</h4>
<h5>1.a Speedup split</h5>
<pre class="fragment"># it's faster to use systems bunzip:
bzcat country.osm.bz2 | java -jar gazetteer.jar split - none
</pre><h5>1.b Memory tweaking</h5>
<pre class="fragment"># First option is to use --x10 flag for slice
# it says to gazetteer to slice data into smaller peaces  
java -jar gazetteer.jar slice --x10

# Second option is to split data step by step
# See java -jar gazetteer.jar slice --help for list of types
java -jar gazetteer.jar slice boundaries
java -jar gazetteer.jar slice highways
java -jar gazetteer.jar slice addresses

# and then join as always
java -jar gazetteer.jar join --handlers out-gazetteer file.json.gz

# if you still gets OutOfMemory on join stage, try to set down number of threads
java -jar gazetteer.jar --threads 2 join --handlers out-gazetteer file.json.gz 
</pre><h4>2 How to get only smth. (Streets only or POI's only and so on).</h4>
<pre class="fragment"># Split as always 
java -jar gazetteer.jar split country.osm

# Specify type of data which will be used in slice stage
java -jar gazetteer.jar slice boundaries places highways

# Join as always
java -jar gazetteer.jar join --handlers out-gazetteer file.json.gz
</pre><h4>3 How to filter data by boundary</h4>
<pre class="fragment"># Use --check-boundaries boundary1 boundary2 ... Boundaries are combined via and. 
# So result should have boundary1 and boundary2 and so on.
# Boundaries encoded as [r,w]NNNNNNN 
# r for relations, w for ways
# NNNNNNN - relation or way number

java -jar gazetteer.jar join --check-boundaries r123456 --handlers out-gazetteer file.json.gz

# And remember, if you use --check-boundaries and boundary wasn't parsed during slice stage
# results will be empty
</pre><h4>4 What can I do with broken boundaries (see option 3).</h4>
<pre class="fragment"># Use --boundaries-fallback-file option.
# Fall back file is a simple csv file with 
# id, timestamp and geometry (as wkt) of boundaries

# So you could add prebuilded boundary into this file
# or use this file for every conversion, in this case
# if new version of osm dump has broken boundary multipolygon
# old version will be used. And if boundary successfully parsed
# and has valid geometry, boundary fallback file will be updated. 

java -jar gazetteer.jar slice --boundaries-fallback-file boundaries.csv
</pre><h4>5 POI classification.</h4>
<pre class="fragment"># By default poi parsed and filtered according to https://github.com/kiselev-dv/osm-doc 
# You could specify your own osm-doc xml via --poi-catalog

java -jar gazetteer.jar slice --poi-catalog osm-doc.xml</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 25 2015 18:36:04 for Gazetteer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
